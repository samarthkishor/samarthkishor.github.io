<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="alternate" type="application/rss+xml" href=
  "https://samarthkishor.github.io/blog/rss.xml" title=
  "RSS feed for https://samarthkishor.github.io/blog/">
  <title>Samarth's Blog</title>
  <meta name="author" content="Samarth Kishor">
  <meta name="referrer" content="no-referrer">
  <link href="static/style.css" rel="stylesheet" type="text/css">
</head>
<body>
  <div id="preamble" class="status">
    <header>
      <nav>
        <ul>
          <li>
            <a href="/">About</a>
          </li>
          <li>
            <a href="/blog/archive.html">Blog</a>
          </li>
        </ul>
      </nav>
    </header>
  </div>
  <div id="content">
    <div class="post-date">
      11 Mar 2020
    </div>
    <h1 class="post-title"><a href=
    "https://samarthkishor.github.io/blog/fizzbuzz-approaches.html">
    Three Completely Different Approaches to the FizzBuzz
    Problem</a></h1>
    <p>Here’s a solution to the classic infamous FizzBuzz problem
    in Python:</p>
    <div class="org-src-container">
      <pre class="src src-python"><span style=
      "color: #80A0C2;">for</span> i <span style=
      "color: #80A0C2;">in</span> <span style=
      "color: #8EBCBB;">range</span>(<span style=
      "color: #B58DAE; font-weight: bold;">1</span>, <span style=
      "color: #B58DAE; font-weight: bold;">31</span>):
    <span style="color: #80A0C2;">if</span> i % <span style=
"color: #B58DAE; font-weight: bold;">15</span> == <span style=
"color: #B58DAE; font-weight: bold;">0</span>:
        <span style="color: #80A0C2;">print</span>(<span style=
"color: #A2BF8A;">"FizzBuzz"</span>)
    <span style="color: #80A0C2;">elif</span> i % <span style=
"color: #B58DAE; font-weight: bold;">3</span> == <span style=
"color: #B58DAE; font-weight: bold;">0</span>:
        <span style="color: #80A0C2;">print</span>(<span style=
"color: #A2BF8A;">"Fizz"</span>)
    <span style="color: #80A0C2;">elif</span> i % <span style=
"color: #B58DAE; font-weight: bold;">5</span> == <span style=
"color: #B58DAE; font-weight: bold;">0</span>:
        <span style="color: #80A0C2;">print</span>(<span style=
"color: #A2BF8A;">"Buzz"</span>)
    <span style="color: #80A0C2;">else</span>:
        <span style="color: #80A0C2;">print</span>(i)
</pre>
    </div>
    <pre class="example">
1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
17
Fizz
19
Buzz
Fizz
22
23
Fizz
Buzz
26
Fizz
28
29
FizzBuzz
</pre>
    <p>This program is really simple and is probably the most
    common approach. You just need to understand how
    <code>if</code> statements work and you’re good to go.</p>
    <p>We can take this up a notch by using type-driven exhaustive
    pattern-matching so that our programming language can actually
    tell us if we’ve made a mistake in our implementation. Here’s
    version 2 of the FizzBuzz program using the OCaml programming
    language:</p>
    <div class="org-src-container">
      <pre class="src src-ocaml"><span style=
      "color: #f5deb3; font-weight: bold;">open </span><span style=
      "color: #ECCC87;">Base</span>

<span style="color: #f5deb3; font-weight: bold;">let</span> () =
  <span style="color: #80A0C2;">for</span> i = <span style=
"color: #B58DAE; font-weight: bold;">1</span> <span style=
"color: #80A0C2;">to</span> <span style=
"color: #B58DAE; font-weight: bold;">30</span> <span style=
"color: #80A0C2;">do</span>
    <span style="color: #80A0C2;">match</span> <span style=
"color: #ECCC87;">Int.</span>rem i <span style=
"color: #B58DAE; font-weight: bold;">3</span>, <span style=
"color: #ECCC87;">Int.</span>rem i <span style=
"color: #B58DAE; font-weight: bold;">5</span> <span style=
"color: #80A0C2;">with</span>
    | <span style=
"color: #B58DAE; font-weight: bold;">0</span>, <span style=
"color: #B58DAE; font-weight: bold;">0</span> -&gt; <span style=
"color: #ECCC87;">Stdio.</span>print_endline <span style=
"color: #A2BF8A;">"FizzBuzz"</span>
    | <span style=
"color: #B58DAE; font-weight: bold;">0</span>, _ -&gt; <span style=
"color: #ECCC87;">Stdio.</span>print_endline <span style=
"color: #A2BF8A;">"Fizz"</span>
    | _, <span style=
"color: #B58DAE; font-weight: bold;">0</span> -&gt; <span style=
"color: #ECCC87;">Stdio.</span>print_endline <span style=
"color: #A2BF8A;">"Buzz"</span>
    | _, _ -&gt; <span style=
"color: #ECCC87;">Stdio.</span>printf <span style=
"color: #A2BF8A;">"%d\n"</span> i
  <span style="color: #80A0C2;">done</span>
</pre>
    </div>
    <pre class="example">
1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
17
Fizz
19
Buzz
Fizz
22
23
Fizz
Buzz
26
Fizz
28
29
FizzBuzz
</pre>
    <p>Notice the <code>match</code> expression right after the
    <code>for</code> loop. OCaml has a really powerful type system
    that can catch some tricky edge cases in our logic at compile
    time. The function <code>Int.rem</code> is just like modulo in
    other languages (I’m using the <code>Base</code> alternate
    standard library for OCaml—the default language comes with a
    <code>mod</code> operator). All the <code>match</code>
    expression in the code above is doing is saying: “If i mod 3 is
    0 and i mod 5 is 0, then print FizzBuzz, else if i mod 3 is 0
    and i mod 5 is anything, then print Fizz, else if i mod 3 is
    anything and i mod 5 is 0, then print Buzz, else print i if
    both are anything”.</p>
    <p>That looks an awful lot like a standard <code>if</code>
    statement to me. The real advantage comes when you forget to
    include a case:</p>
    <div class="org-src-container">
      <pre class="src src-ocaml"><span style=
      "color: #f5deb3; font-weight: bold;">open </span><span style=
      "color: #ECCC87;">Base</span>

<span style="color: #f5deb3; font-weight: bold;">let</span> () =
  <span style="color: #80A0C2;">for</span> i = <span style=
"color: #B58DAE; font-weight: bold;">1</span> <span style=
"color: #80A0C2;">to</span> <span style=
"color: #B58DAE; font-weight: bold;">30</span> <span style=
"color: #80A0C2;">do</span>
    <span style="color: #80A0C2;">match</span> <span style=
"color: #ECCC87;">Int.</span>rem i <span style=
"color: #B58DAE; font-weight: bold;">3</span>, <span style=
"color: #ECCC87;">Int.</span>rem i <span style=
"color: #B58DAE; font-weight: bold;">5</span> <span style=
"color: #80A0C2;">with</span>
    | <span style=
"color: #B58DAE; font-weight: bold;">0</span>, <span style=
"color: #B58DAE; font-weight: bold;">0</span> -&gt; <span style=
"color: #ECCC87;">Stdio.</span>print_endline <span style=
"color: #A2BF8A;">"FizzBuzz"</span>
    | <span style=
"color: #B58DAE; font-weight: bold;">0</span>, _ -&gt; <span style=
"color: #ECCC87;">Stdio.</span>print_endline <span style=
"color: #A2BF8A;">"Fizz"</span>
    | _, <span style=
"color: #B58DAE; font-weight: bold;">0</span> -&gt; <span style=
"color: #ECCC87;">Stdio.</span>print_endline <span style=
"color: #A2BF8A;">"Buzz"</span>
    <span style="color: #6f7787;">(* </span><span style=
"color: #6f7787;">| _, _ -&gt; Stdio.printf "%d\n" i &lt;-- commented out </span><span style="color: #6f7787;">*)</span>
  <span style="color: #80A0C2;">done</span>
</pre>
    </div>
    <pre class="example">
Characters 45-207:
  ....match Int.rem i 3, Int.rem i 5 with
      | 0, 0 -&gt; Stdio.print_endline "FizzBuzz"
      | 0, _ -&gt; Stdio.print_endline "Fizz"
      | _, 0 -&gt; Stdio.print_endline "Buzz"
Warning 8: this pattern-matching is not exhaustive.
Here is an example of a case that is not matched:
(1, 1)
Exception: Match_failure ("//toplevel//", 300, 4).
Raised at file "//toplevel//", line 303, characters 14-40
Called from file "toplevel/toploop.ml", line 180, characters 17-56
</pre>
    <p>This is really cool—OCaml’s compiler knows when the
    <code>match</code> statement doesn’t cover all the possible
    cases and will even give you an example of a case that wasn’t
    met! Once we include that last case, the program will
    successfully compile. Depending how you structure your pattern
    matching, the compiler will sometimes even tell you if you’ve
    used redundant or incorrect cases. It’s a killer feature and I
    wish more languages had it. Exhaustive pattern matching like
    this is usually unique to strongly typed functional programming
    languages, although Rust has also adopted this feature and I’m
    sure others will follow.</p>
    <p>Now for the third and wildest approach to solving the
    FizzBuzz problem—this time with Clojure. Clojure is a Lisp
    dialect that emphasizes functional programming and immutable
    data structures. This language also happens to have great
    support for lazy sequences—a feature that this particular
    FizzBuzz program uses heavily.</p>
    <p>A lazy sequence is not evaluated immediately—instead, it
    delays its evaluation until it is needed by another
    function.</p>
    <p>To illustrate this, here’s the documentation for the
    <code>cycle</code> function in Clojure:</p>
    <div class="org-src-container">
      <pre class="src src-clojure"><span style=
      "color: #80A0C2;">(</span>doc cycle<span style=
      "color: #80A0C2;">)</span>
</pre>
    </div>
    <pre class="example">
-------------------------
clojure.core/cycle
([coll])
  Returns a lazy (infinite!) sequence of repetitions of the items in coll.
</pre>
    <p>How do you use these so-called infinite sequences without
    using up all the memory in your computer? The key to using lazy
    sequences is that these functions are not evaluated until they
    are needed by another function. So running this:</p>
    <div class="org-src-container">
      <pre class="src src-clojure"><span style=
      "color: #80A0C2;">(</span>cycle '<span style=
      "color: #B58DAE;">(</span><span style=
      "color: #A2BF8A;">"Fizz"</span> <span style=
      "color: #A2BF8A;">"Buzz"</span><span style=
      "color: #B58DAE;">)</span><span style=
      "color: #80A0C2;">)</span>
</pre>
    </div>
    <p>would just hang the Clojure session because it’s waiting to
    be evaluated. Let’s fix that by taking some values from this
    infinite sequence.</p>
    <div class="org-src-container">
      <pre class="src src-clojure"><span style=
      "color: #80A0C2;">(</span>take <span style=
      "color: #B58DAE; font-weight: bold;">10</span> <span style=
      "color: #B58DAE;">(</span>cycle '<span style=
      "color: #A2BF8A;">(</span><span style=
      "color: #A2BF8A;">"Fizz"</span> <span style=
      "color: #A2BF8A;">"Buzz"</span><span style=
      "color: #A2BF8A;">)</span><span style=
      "color: #B58DAE;">)</span><span style=
      "color: #80A0C2;">)</span>
</pre>
    </div>
    <table>
      <colgroup>
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
        <col class="org-left">
      </colgroup>
      <tbody>
        <tr>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
        </tr>
      </tbody>
    </table>
    <p>Now we can write a completely different FizzBuzz
    implementation leveraging the power of these lazy sequences. I
    modified the example from <a href=
    "http://www.petecorey.com/blog/2018/07/09/golfing-for-fizzbuzz-in-clojure-and-elixir/">
    this blog post</a> so the output would match my Python and
    OCaml programs.</p>
    <div class="org-src-container">
      <pre class="src src-clojure"><span style=
      "color: #80A0C2;">(</span><span style=
      "color: #80A0C2;">doseq</span>
    <span style="color: #B58DAE;">[</span>x
     <span style="color: #A2BF8A;">(</span><span style=
"color: #80A0C2;">-&gt;&gt;</span>
      <span style="color: #80A0C2;">(</span>map list
           <span style="color: #B58DAE;">(</span>range <span style=
"color: #B58DAE; font-weight: bold;">31</span><span style=
"color: #B58DAE;">)</span>
           <span style="color: #B58DAE;">(</span>cycle <span style=
"color: #A2BF8A;">[</span><span style=
"color: #A2BF8A;">"Fizz"</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span><span style=
"color: #A2BF8A;">]</span><span style="color: #B58DAE;">)</span>
           <span style="color: #B58DAE;">(</span>cycle <span style=
"color: #A2BF8A;">[</span><span style=
"color: #A2BF8A;">"Buzz"</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span><span style=
"color: #A2BF8A;">]</span><span style=
"color: #B58DAE;">)</span><span style="color: #80A0C2;">)</span>
      <span style="color: #80A0C2;">(</span>rest<span style=
"color: #80A0C2;">)</span>
      <span style="color: #80A0C2;">(</span>map <span style=
"color: #B58DAE;">(</span><span style=
"color: #80A0C2;">fn</span> <span style=
"color: #A2BF8A;">[</span>lst<span style="color: #A2BF8A;">]</span>
             <span style="color: #A2BF8A;">(</span><span style=
"color: #80A0C2;">let</span> <span style=
"color: #80A0C2;">[</span>i <span style=
"color: #B58DAE;">(</span>first lst<span style=
"color: #B58DAE;">)</span><span style="color: #80A0C2;">]</span>
               <span style="color: #80A0C2;">(</span><span style=
"color: #80A0C2;">if</span> <span style=
"color: #B58DAE;">(</span><span style=
"color: #80A0C2;">or</span> <span style=
"color: #A2BF8A;">(</span>= <span style=
"color: #B58DAE; font-weight: bold;">0</span> <span style=
"color: #80A0C2;">(</span>mod i <span style=
"color: #B58DAE; font-weight: bold;">3</span><span style=
"color: #80A0C2;">)</span><span style=
"color: #A2BF8A;">)</span> <span style=
"color: #A2BF8A;">(</span>= <span style=
"color: #B58DAE; font-weight: bold;">0</span> <span style=
"color: #80A0C2;">(</span>mod i <span style=
"color: #B58DAE; font-weight: bold;">5</span><span style=
"color: #80A0C2;">)</span><span style=
"color: #A2BF8A;">)</span><span style="color: #B58DAE;">)</span>
                 <span style=
"color: #B58DAE;">(</span>apply str <span style=
"color: #A2BF8A;">(</span>concat <span style=
"color: #80A0C2;">(</span>rest lst<span style=
"color: #80A0C2;">)</span><span style=
"color: #A2BF8A;">)</span><span style="color: #B58DAE;">)</span>
                 <span style=
"color: #B58DAE;">(</span>apply str <span style=
"color: #A2BF8A;">(</span>concat lst<span style=
"color: #A2BF8A;">)</span><span style=
"color: #B58DAE;">)</span><span style=
"color: #80A0C2;">)</span><span style=
"color: #A2BF8A;">)</span><span style=
"color: #B58DAE;">)</span><span style=
"color: #80A0C2;">)</span><span style=
"color: #A2BF8A;">)</span><span style="color: #B58DAE;">]</span>
  <span style="color: #B58DAE;">(</span>println x<span style=
"color: #B58DAE;">)</span><span style="color: #80A0C2;">)</span>
</pre>
    </div>
    <pre class="example">
1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
17
Fizz
19
Buzz
Fizz
22
23
Fizz
Buzz
26
Fizz
28
29
FizzBuzz
</pre>
    <p>The four lines of code below is the heart of the program. It
    uses the <code>range</code> function to assign numbers to the
    first elements of the lists and then uses the two
    <code>cycle</code> functions to assign either the empty string,
    Fizz, or Buzz to the second and third elements of the list
    respectively. It’s a really neat declarative way of
    implementing FizzBuzz and my mind was completely blown when I
    understood what the program really does.</p>
    <div class="org-src-container">
      <pre class="src src-clojure"><span style=
      "color: #80A0C2;">(</span>map list
     <span style="color: #B58DAE;">(</span>range <span style=
"color: #B58DAE; font-weight: bold;">31</span><span style=
"color: #B58DAE;">)</span>
     <span style="color: #B58DAE;">(</span>cycle <span style=
"color: #A2BF8A;">[</span><span style=
"color: #A2BF8A;">"Fizz"</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span><span style=
"color: #A2BF8A;">]</span><span style="color: #B58DAE;">)</span>
     <span style="color: #B58DAE;">(</span>cycle <span style=
"color: #A2BF8A;">[</span><span style=
"color: #A2BF8A;">"Buzz"</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span> <span style=
"color: #A2BF8A;">""</span><span style=
"color: #A2BF8A;">]</span><span style=
"color: #B58DAE;">)</span><span style="color: #80A0C2;">)</span>
</pre>
    </div>
    <table>
      <colgroup>
        <col class="org-right">
        <col class="org-left">
        <col class="org-left">
      </colgroup>
      <tbody>
        <tr>
          <td class="org-right">0</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
        </tr>
        <tr>
          <td class="org-right">1</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">2</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">3</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">4</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">5</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">Buzz</td>
        </tr>
        <tr>
          <td class="org-right">6</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">7</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">8</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">9</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">10</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">Buzz</td>
        </tr>
        <tr>
          <td class="org-right">11</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">12</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">13</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">14</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">15</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
        </tr>
        <tr>
          <td class="org-right">16</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">17</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">18</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">19</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">20</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">Buzz</td>
        </tr>
        <tr>
          <td class="org-right">21</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">22</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">23</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">24</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">25</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">Buzz</td>
        </tr>
        <tr>
          <td class="org-right">26</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">27</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">28</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">29</td>
          <td class="org-left">&nbsp;</td>
          <td class="org-left">&nbsp;</td>
        </tr>
        <tr>
          <td class="org-right">30</td>
          <td class="org-left">Fizz</td>
          <td class="org-left">Buzz</td>
        </tr>
      </tbody>
    </table>
    <p>I never knew FizzBuzz could be solved in so many different
    ways and it’s a neat little problem to illustrate the strengths
    and styles of different programming languages: Python is great
    for writing legible imperative code that’s simple yet
    expressive. OCaml is great for writing safe strongly typed code
    with exhaustive compiler checks when you need them. Clojure is
    great for writing highly dynamic functional code which uses
    lots of abstractions that makes working with data much
    easier.</p>
    <div class="taglist">
      <a href=
      "https://samarthkishor.github.io/blog/tags.html">Tags</a>:
      <a href=
      "https://samarthkishor.github.io/blog/tag-programming.html">programming</a>
      <a href=
      "https://samarthkishor.github.io/blog/tag-python.html">python</a>
      <a href=
      "https://samarthkishor.github.io/blog/tag-ocaml.html">ocaml</a>
      <a href=
      "https://samarthkishor.github.io/blog/tag-lisp.html">lisp</a>
    </div>
    <div class="post-date">
      09 Mar 2020
    </div>
    <h1 class="post-title"><a href=
    "https://samarthkishor.github.io/blog/process-hacking.html">Remote
    Linux Process Hacking through SSH</a></h1>
    <p>There’s this really cool <a href=
    "https://www.youtube.com/playlist?list=PLBgJcoaU2hl-JnoVOzjYB5qk_PfYjPm-I">
    process hacking series</a> on YouTube by Keist Zenon. He uses
    the programming language Common Lisp to interact with processes
    on his Linux machine. I tried following the tutorial on my Mac,
    but macOS does not have the same <code>ptrace</code> commands
    and system call interfaces as Linux so this did not work out.
    However, I have VirtualBox set up on my Mac with a Debian VM
    which I use whenever I need Linux.</p>
    <p>Here’s the idea: is it possible to hack processes on my
    Linux VM from Emacs on my Mac? I found out that it’s not only
    possible, but it’s actually surprisingly easy.</p>
    <div id="outline-container-org5d0097d" class="outline-2">
      <h2 id="org5d0097d">Configuring the Virtual Machine</h2>
      <div class="outline-text-2" id="text-org5d0097d">
        <p>First you’ll need to set up a Bridged Adapter on your
        VirtualBox VM to allow your host machine to connect to it
        via SSH. <a href=
        "https://www.youtube.com/watch?v=ErzhbUusgdI">This YouTube
        tutorial</a> was pretty helpful. You’ll just have to change
        how you enable the SSH service on your Linux VM—I’m on
        Debian so I had to run the command</p>
        <div class="org-src-container">
          <pre class="src src-sh">
          systemctl status ssh | <span style=
"color: #ECCC87;">cat</span> | <span style=
"color: #ECCC87;">grep</span> active
</pre>
        </div>
        <pre class="example">
Active: active (running) since Fri 2020-03-13 18:24:14 EDT; 9min ago
</pre>
        <p>to see if SSH was enabled.</p>
        <p>To attach and manipulate this process, we need to use
        the <code>ptrace</code> function. You can see the
        documentation for it with the command <code>man 2
        ptrace</code> (2 stands for the second section of the
        manual, since we want the C system call function for
        <code>ptrace</code> instead of the general UNIX command).
        We could use C for process hacking, but it’s a lot nicer to
        use an interactive language like Lisp. Plus, it’s possible
        to interact with a remote Lisp REPL from your host
        machine’s local Emacs instance through SSH. Common Lisp is
        pretty amazing—I don’t know if many other programming
        languages have these features.</p>
        <p>Clone <a href=
        "https://github.com/k-stz/cl-ptrace">Keist’s GitHub
        repo</a> to your VM to get his Common Lisp library for
        process hacking with <code>ptrace</code>. The code here is
        essentially the same as the tutorial, except you might have
        to remove the line that says</p>
        <div class="org-src-container">
          <pre class="src src-common-lisp"><span style=
          "color: #80A0C2;">(</span><span style=
          "color: #8EBCBB;">:file</span> <span style=
          "color: #A2BF8A;">"cl-ptrace/async-functions"</span><span style=
          "color: #80A0C2;">)</span>
</pre>
        </div>
        <p>since that file doesn’t exist in the repo for some
        reason. Install your Common Lisp implementation of choice
        (I use <code>sbcl</code> since it’s well-supported on most
        platforms) and follow the instructions on the <a href=
        "https://www.quicklisp.org/beta/">Quicklisp website</a> to
        install Quicklisp. Quicklisp is the unofficial package
        manager for Common Lisp.</p>
        <p>Once you’ve successfully installed Quicklisp, you need
        to set up a Lisp REPL on the remote VM so it can talk to
        your local Emacs editor. Quit out of your <code>sbcl</code>
        repl and run it as root. We need Lisp to run as root since
        the <code>ptrace</code> system calls need root access.</p>
        <div class="org-src-container">
          <pre class="src src-sh"><span style=
          "color: #ECCC87;">sudo</span> sbcl
</pre>
        </div>
        <p>In his tutorial, Kaiste avoided this problem by running
        Emacs as root since he was hacking processes from the same
        machine. However, we don’t want to do this since running
        Emacs as root can be dangerous, plus we are trying to hack
        processes on our <i>remote</i> machine from our <i>local
        (host)</i> Emacs editor, so running Emacs locally as root
        wouldn’t really be useful.</p>
        <p>Use Quicklisp to load/install <code>ASDF</code> and
        <code>slynk</code>, and then create a <code>slynk</code>
        server on port 4006. You can use the default port 4005 if
        it’s open.</p>
        <div class="org-src-container">
          <pre class="src src-common-lisp"><span style=
          "color: #80A0C2;">(</span>ql:quickload <span style=
          "color: #8EBCBB;">:asdf</span><span style=
          "color: #80A0C2;">)</span>
<span style="color: #80A0C2;">(</span>ql:quickload <span style=
"color: #8EBCBB;">:slynk</span><span style=
"color: #80A0C2;">)</span>
<span style=
"color: #80A0C2;">(</span>slynk:create-server <span style=
"color: #8EBCBB;">:port</span> <span style=
"color: #B58DAE; font-weight: bold;">4006</span><span style=
"color: #80A0C2;">)</span>
</pre>
        </div>
        <p>If you get stuck, follow the instructions in <a href=
        "https://joaotavora.github.io/sly/#Setting-up-the-Lisp-image">
        the SLY manual</a>, but I think Quicklisp makes this
        process a bit easier.</p>
        <p>Now fire up a new terminal and get your VM’s ip address.
        On Debian, the command is</p>
        <div class="org-src-container">
          <pre class="src src-sh">hostname -I
</pre>
        </div>
        <p>After that, SSH into your VM from your <i>host</i>
        machine to create an SSH tunnel that we’ll take advantage
        of later.</p>
        <div class="org-src-container">
          <pre class="src src-sh">
          ssh -L4006:localhost:4006 &lt;username&gt;@&lt;ip-address&gt;
</pre>
        </div>
        <p>Change <code>4006</code> to the port that
        <code>slynk</code> is using to run your Lisp server, and
        change the <code>&lt;username&gt;</code> and
        <code>&lt;ip-address&gt;</code> fields. Remember to run
        this command from your host machine, not the VM.</p>
        <p>Once your SSH tunnel is set up, follow the instructions
        in section 8.1.3 of the SLY manual (linked above) to
        configure Emacs to translate filenames between the remote
        and host machines. Make sure you have TRAMP installed and
        working in Emacs. Now you can connect to your VM from your
        host machine’s Emacs using TRAMP. <code>C-x C-f
        /ssh:&lt;username&gt;@&lt;ip-address&gt;</code> should do
        the trick. Now you can navigate to the
        <code>cl-ptrace</code> repo.</p>
        <p>The setup is pretty much over: now we can start hacking.
        Compile the <code>spam.c</code> file in the
        <code>cl-ptrace</code> repo on your VM into the executable
        <code>spam</code> and run it.</p>
        <div class="org-src-container">
          <pre class="src src-sh">gcc spam.c -o spam
./spam
</pre>
        </div>
        <p>We want to get the process id (<code>pid</code>) of this
        <code>spam</code> program so we can interact with it. To do
        this, run the command</p>
        <div class="org-src-container">
          <pre class="src src-sh" id="org0d18523">
          ps -a | <span style=
"color: #ECCC87;">grep</span> spam | awk <span style=
"color: #A2BF8A;">'{ print $1 }'</span>
</pre>
        </div>
        <pre class="example">
1543
</pre>
        <p>We can then display information about the process with
        <code>top</code>. You can get a nicer output by using the
        <code>htop</code> program.</p>
        <div class="org-src-container">
          <pre class="src src-sh">top -p $<span style=
          "color: #dac6d6;">PID</span>
</pre>
        </div>
        <p>We can even limit the output of <code>top</code> to just
        get the CPU usage. The <code>sed</code> commands are just
        for making the output nicer.</p>
        <div class="org-src-container">
          <pre class="src src-sh">top -p $<span style=
          "color: #dac6d6;">PID</span> -n <span style=
          "color: #B58DAE; font-weight: bold;">2</span> -b | <span style=
          "color: #ECCC87;">grep</span> Cpu | sed <span style=
          "color: #A2BF8A;">'s/\:/\: /'</span> | sed <span style=
          "color: #A2BF8A;">'s/us,.*/ /'</span>
</pre>
        </div>
        <table>
          <colgroup>
            <col class="org-left">
            <col class="org-right">
          </colgroup>
          <tbody>
            <tr>
              <td class="org-left">%Cpu(s):</td>
              <td class="org-right">68.7</td>
            </tr>
            <tr>
              <td class="org-left">%Cpu(s):</td>
              <td class="org-right">99.7</td>
            </tr>
          </tbody>
        </table>
        <p>Notice that the <code>spam</code> program is taking up
        over 90% of the CPU since it’s an infinite
        <code>while</code> loop in a single-threaded process.</p>
      </div>
    </div>
    <div id="outline-container-org01037b7" class="outline-2">
      <h2 id="org01037b7">Hacking in Emacs</h2>
      <div class="outline-text-2" id="text-org01037b7">
        <p>Next, switch back to Emacs (on the host machine) and
        make sure you’re in the remote <code>cl-ptrace</code> repo
        via TRAMP. We want to connect to the remote Lisp server
        from Emacs, so run the command <code>M-x
        sly-connect</code>, keep the default host as
        <code>localhost</code>, and change the port to the
        <code>slynk</code> server port.</p>
        <p>Now you have a local Lisp REPL that is connected to your
        VM via the SSH tunnel we created earlier. Load the file
        <code>cl-ptrace.asd</code> with the command <code>M-x
        sly-load-file</code>. The file is on the remote VM, but
        this isn’t a problem because TRAMP should be configured to
        handle the remote filenames (we did this earlier). This
        should load the file into the <code>sly</code> REPL. Then
        run <code>(asdf:load-system "cl-ptrace")</code> to load the
        <code>cl-ptrace</code> library into the REPL, and run
        <code>(in-package :cl-ptrace)</code> to start using the
        library.</p>
        <p>Make sure that you’re root by running the function
        <code>(am-i-root?)</code>. It should return <code>T</code>.
        Now you’ve successfully created a mechanism to hack remote
        processes from your local machine using Common Lisp and
        Emacs. Go ahead and follow along with the rest of Kaiste’s
        videos—they’re amazing.</p>
      </div>
    </div>
    <div class="taglist">
      <a href=
      "https://samarthkishor.github.io/blog/tags.html">Tags</a>:
      <a href=
      "https://samarthkishor.github.io/blog/tag-programming.html">programming</a>
      <a href=
      "https://samarthkishor.github.io/blog/tag-lisp.html">lisp</a>
      <a href=
      "https://samarthkishor.github.io/blog/tag-linux.html">linux</a>
    </div>
    <div class="post-date">
      08 Mar 2020
    </div>
    <h1 class="post-title"><a href=
    "https://samarthkishor.github.io/blog/interactive-ocaml-development.html">
    Interactive OCaml Development</a></h1>
    <p>Interactive development features are mostly found in
    dynamically-typed interpreted programming languages like Python
    or JavaScript. While OCaml is a statically-typed compiled
    language, it is still possible to program in an interactive
    style using a REPL. However, OCaml will never be quite as
    flexible and interactive as something like Lisp because of its
    greatest feature: the strong static type system.</p>
    <div id="outline-container-orgc9abdcc" class="outline-2">
      <h2 id="orgc9abdcc">Testing functions using the REPL</h2>
      <div class="outline-text-2" id="text-orgc9abdcc">
        <p>One of the nicest features of OCaml is that is has both
        a byte-code compiler (<code>ocamlc</code>) and a
        native-code compiler (<code>ocamlopt</code>). This means
        that you can develop programs in an interactive, <a href=
        "http://www.paulgraham.com/progbot.html">bottom-up</a>
        style using the REPL. Bottom-up development is a technique
        most-often leveraged by Lisp programmers in which you can
        write a single function, compile it and send it to the
        REPL, and then test that function interactively in the
        REPL. OCaml’s fast bytecode compiler makes it possible to
        use this technique that is usually unique to Lisps and
        interpreted languages.</p>
      </div>
      <div id="outline-container-orgffdd2a5" class="outline-3">
        <h3 id="orgffdd2a5">Sending code to the REPL in Emacs</h3>
        <div class="outline-text-3" id="text-orgffdd2a5">
          <p>I’ll describe the process for interactive development
          using Emacs which is my text editor of choice. Similar
          techniques should exist for other editors such as VS Code
          or Vim.</p>
          <p>OCaml’s REPL is called <code>utop</code> and it has a
          lot of nice features that make it well-suited for
          interactive development. If you’re using Emacs, you can
          send your OCaml code to <code>utop</code> to be
          evaluated. Here’s an example of using <code>utop</code>
          to test a single function.</p>
          <div class="org-src-container">
            <pre class="src src-ocaml"><span style=
            "color: #f5deb3; font-weight: bold;">open </span><span style=
            "color: #ECCC87;">Base</span>

<span style=
"color: #f5deb3; font-weight: bold;">let</span> <span style=
"color: #8EBCBB;">sum_list</span> <span style=
"color: #dac6d6;">list</span> = <span style=
"color: #ECCC87;">List.</span>fold <span style=
"color: #B58DAE;">~f</span>:( <span style=
"color: #8EBCBB;">+</span> ) <span style=
"color: #B58DAE;">~init</span>:<span style=
"color: #B58DAE; font-weight: bold;">0</span> list
</pre>
          </div>
          <p>To send this code to <code>utop</code>, highlight it
          and press <code>C-x C-r</code> (or <code>M-x
          utop-eval-region RET</code>). You can even send an entire
          buffer to <code>utop</code> by pressing <code>C-c
          C-b</code> via the function
          <code>utop-eval-buffer</code>. If you use the
          <code>dune</code> build system and configure Emacs
          appropriately (instructions on how to do this are in the
          <a href=
          "https://github.com/ocaml-community/utop#main-setup">utop
          documentation</a>), a dialog will pop up saying: “utop
          command line: opam config exec – dune utop . – -emacs”.
          Press <code>RET</code> to evaluate the code.</p>
          <p>You might have seen a message saying “Error: unbound
          module Base”. This code uses <a href=
          "https://opensource.janestreet.com/base/">Jane Street’s
          Base alternative standard library</a> which makes things
          a bit more complicated, since <code>utop</code> does not
          know about Base by default.</p>
          <p>To solve this, create a new file in the same directory
          called <code>.ocamlinit</code>. <code>utop</code> reads
          this file before starting and executes the commands
          specified. You just need to include a single line to load
          the Base library into <code>utop</code>:</p>
          <div class="org-src-container">
            <pre class="src src-ocaml"><span style=
            "color: #778899;">#require</span> <span style=
            "color: #A2BF8A;">"base"</span><span style=
            "color: #ff4500;">;;</span>
</pre>
          </div>
          <p>Now try the previous steps again to load the
          <code>sum_list</code> function into <code>utop</code>. If
          this still doesn’t work, make sure your <code>opam</code>
          environment is set up correctly by running the command
          <code>opam switch</code> in a terminal and following the
          instructions.</p>
          <p>Once everything is working, go ahead and test the
          function in the REPL by running <code>sum_list [1; 2;
          3];;</code> (the double semicolons at the end of the line
          are important because <code>utop</code> uses them to mark
          the end of an expression). If you want to make changes to
          the function, simply switch back to the OCaml buffer,
          edit the code, and send it back to <code>utop</code>.</p>
        </div>
      </div>
      <div id="outline-container-org59e2d3d" class="outline-3">
        <h3 id="org59e2d3d">Working with multiple files in the
        REPL</h3>
        <div class="outline-text-3" id="text-org59e2d3d">
          <p>The technique I described above works great within a
          single file, but things get complicated once you send
          code from multiple files to the same <code>utop</code>
          instance. For example, say you made the
          <code>sum_list</code> function within a file called
          <code>test.ml</code> and sent that code to
          <code>utop</code>. Now you want to use
          <code>Test.sum_list</code> within another file, so you
          create a new file called <code>use_test.ml</code> which
          implements a new function:</p>
          <div class="org-src-container">
            <pre class="src src-ocaml"><span style=
            "color: #f5deb3; font-weight: bold;">let</span> <span style=
            "color: #8EBCBB;">double_sum_list</span> <span style=
            "color: #dac6d6;">list</span> = (<span style=
            "color: #ECCC87;">Test.</span>sum_list list) * <span style=
            "color: #B58DAE; font-weight: bold;">2</span>
</pre>
          </div>
          <p>Now when you go to send this new function to
          <code>utop</code>, you run into an error: “Error: Unbound
          module Test”.</p>
          <p>Here’s the full sample <code>utop</code> session:</p>
          <pre class="example">
utop[0]&gt; open Base

let sum_list list = List.fold ~f:( + ) ~init:0 list
;;
val sum_list : int list -&gt; int = &lt;fun&gt;
utop[1]&gt; sum_list [1; 2; 3];;
- : int = 6
utop[2]&gt; let double_sum_list list = (Test.sum_list list) * 2
;;

Error: Unbound module Test
</pre>
          <p>Since OCaml isn’t really made to be an interactive
          programming language, there isn’t a clean solution for
          this problem as far as I’m aware. However, you can hack
          around this using the same <code>.ocamlinit</code> file
          that I mentioned before.</p>
          <p>Kill <code>utop</code> and modify the
          <code>.ocamlinit</code> file to look like this:</p>
          <div class="org-src-container">
            <pre class="src src-ocaml"><span style=
            "color: #778899;">#require</span> <span style=
            "color: #A2BF8A;">"base"</span><span style=
            "color: #ff4500;">;;</span>
<span style="color: #778899;">#mod_use</span> <span style=
"color: #A2BF8A;">"test.ml"</span><span style=
"color: #ff4500;">;;</span>
</pre>
          </div>
          <p>The <code>#mod_use</code> function tells
          <code>utop</code> to import the given file into the REPL
          as a module. This is important because it lets us call
          <code>sum_list</code> as <code>Test.sum_list</code>.
          <code>#mod_use</code> essentially wraps up the functions
          from the file into a module and sends that module to be
          evaluated in the REPL, which is basically how the OCaml
          compiler treats OCaml files. We don’t want to change our
          development style to work with the REPL since
          <code>utop</code> is configurable enough.</p>
          <p>There is one caveat with this approach: you have to
          edit <code>.ocamlinit</code> and restart
          <code>utop</code> whenever you create a new file. If you
          switch files (say you were sending code from
          <code>use_test.ml</code> to the REPL but now want to work
          with <code>test.ml</code>), you have to restart
          <code>utop</code> each time to ensure that it has the
          most up-to-date version of all your files/modules. This
          is a bit of a pain and I’m not sure if there’s a solution
          to this problem given OCaml’s static nature.</p>
        </div>
      </div>
    </div>
    <div id="outline-container-org5ff0129" class="outline-2">
      <h2 id="org5ff0129">Pretty-printing</h2>
      <div class="outline-text-2" id="text-org5ff0129">
        <p>A major part of interactive development is seeing the
        results of functions in the REPL. Since OCaml has a strong
        type system without dynamic dispatch, you can only print
        strings—this means that you have to write functions to
        convert your user-defined types (which are everywhere in
        idiomatic OCaml code) to strings each time you want to
        print them. This is a pain, but luckily there’s an elegant
        solution: <a href=
        "https://github.com/ocaml-ppx/ppx_deriving#plugin-show">ppx</a>.</p>
        <p><code>ppx</code> is a syntax extension to OCaml which
        acts as a macro that automatically generates code to
        pretty-print a custom type
        (<code>ppx_deriving.show</code>), generate equality
        functions (<code>ppx_deriving.eq</code>), etc.</p>
        <p>To pretty-print custom types annotated with
        <code>[@@deriving show]</code> in <code>utop</code>, you’ll
        need to once again modify the <code>.ocamlinit</code> file
        and add the following line:</p>
        <div class="org-src-container">
          <pre class="src src-ocaml"><span style=
          "color: #778899;">#install_printer</span> <span style=
          "color: #ECCC87;">Module.</span>pp<span style=
          "color: #ff4500;">;;</span>
</pre>
        </div>
        <p>where <code>Module</code> is the name of the module
        which has the corresponding <code>pp</code> function.
        Here’s an example of one such module that pretty-prints a
        custom hash-table with the <code>Depths</code> module,
        where <code>type t</code>… <code>[@@deriving show]</code>
        refers to the <code>Resolver.t</code> type:</p>
        <div class="org-src-container">
          <pre class="src src-ocaml"><span style=
          "color: #f5deb3; font-weight: bold;">module</span> <span style=
          "color: #ECCC87;">Depths</span> = <span style=
          "color: #f5deb3; font-weight: bold;">struct</span>
  <span style=
"color: #f5deb3; font-weight: bold;">type</span> <span style=
"color: #ECCC87;">t</span> = (string, int) <span style=
"color: #ECCC87;">Hashtbl.</span>t

  <span style=
"color: #f5deb3; font-weight: bold;">let</span> <span style=
"color: #8EBCBB;">pp</span> <span style=
"color: #dac6d6;">ppf</span> <span style=
"color: #dac6d6;">values</span> =
    <span style=
"color: #ECCC87;">Caml.Format.</span>open_hovbox <span style=
"color: #B58DAE; font-weight: bold;">1</span>;
    <span style="color: #ECCC87;">Caml.Format.</span>print_cut ();
    <span style="color: #80A0C2;">if</span> <span style=
"color: #ECCC87;">Hashtbl.</span>length values = <span style=
"color: #B58DAE; font-weight: bold;">0</span>
    <span style="color: #80A0C2;">then</span> <span style=
"color: #ECCC87;">Caml.Format.</span>fprintf ppf <span style=
"color: #A2BF8A;">"@[&lt;hov 2&gt;{}@]"</span>
    <span style="color: #80A0C2;">else</span> (
      <span style=
"color: #ECCC87;">Caml.Format.</span>fprintf ppf <span style=
"color: #A2BF8A;">"@[&lt;hov 1&gt;{@ @]"</span>;
      <span style=
"color: #ECCC87;">Hashtbl.</span>iteri values <span style=
"color: #B58DAE;">~f</span>:(<span style=
"color: #80A0C2;">fun</span> ~<span style=
"color: #dac6d6;">key</span> ~<span style=
"color: #dac6d6;">data</span> -&gt;
          <span style=
"color: #ECCC87;">Caml.Format.</span>fprintf ppf <span style=
"color: #A2BF8A;">"@[&lt;hov 2&gt;%s: %d,@ @]"</span> key data);
      <span style=
"color: #ECCC87;">Caml.Format.</span>fprintf ppf <span style=
"color: #A2BF8A;">"@[&lt;hov 1&gt;}@]"</span>);
    <span style="color: #ECCC87;">Caml.Format.</span>close_box ()
  <span style="color: #ff4500;">;;</span>
<span style="color: #f5deb3; font-weight: bold;">end</span>

<span style=
"color: #f5deb3; font-weight: bold;">type</span> <span style=
"color: #ECCC87;">t</span> =
  { statements : <span style=
"color: #ECCC87;">Parser.</span>statement list
  ; scopes : <span style="color: #ECCC87;">Scopes.</span>t
  ; depths : <span style="color: #ECCC87;">Depths.</span>t
  ; parsed_statements : <span style=
"color: #ECCC87;">Parser.</span>statement list
  }
<span style=
"color: #80A0C2; font-weight: bold;">[@@deriving show]</span>
</pre>
        </div>
        <p>Here are the corresponding lines in
        <code>.ocamlinit</code> which tell <code>utop</code> which
        types to pretty-print (the above code is from a file called
        <code>resolver.ml</code>):</p>
        <div class="org-src-container">
          <pre class="src src-ocaml"><span style=
          "color: #778899;">#install_printer</span> <span style=
          "color: #ECCC87;">Resolver.</span>pp<span style=
          "color: #ff4500;">;;</span>
<span style="color: #778899;">#install_printer</span> <span style=
"color: #ECCC87;">Resolver.Depths.</span>pp<span style=
"color: #ff4500;">;;</span>
</pre>
        </div>
        <p>Now <code>utop</code> knows to call the respective
        <code>pp</code> function whenever it needs to print type
        information for the corresponding module. I needed to write
        the custom <code>Depths.pp</code> function by hand since
        <code>ppx_deriving.show</code> is not powerful enough to
        work for all custom types. This is one drawback of strong
        static type systems.</p>
      </div>
    </div>
    <div id="outline-container-org6abc4bc" class="outline-2">
      <h2 id="org6abc4bc">Tracing function execution</h2>
      <div class="outline-text-2" id="text-org6abc4bc">
        <p>Say you want to now debug the <code>resolve</code>
        function in your <code>Resolver</code> module, but the
        return value of <code>resolve</code> is of type
        <code>Resolver.t</code>. If you didn’t have the
        <code>[@@deriving show]</code> <code>ppx</code> annotation
        on <code>type t</code> and didn’t write the custom
        <code>Scopes.pp</code> and <code>Depths.pp</code>
        functions, this would be part of the output of tracing a
        call to <code>Resolver.resolve</code> in <code>utop</code>
        (I cut off the rest of the output since it wasn’t
        important):</p>
        <div class="org-src-container">
          <pre class="src src-ocaml">utop[<span style=
          "color: #B58DAE; font-weight: bold;">1</span>]&gt; #trace <span style="color: #ECCC87;">Resolver.</span>resolve<span style="color: #ff4500;">;;</span>
<span style=
"color: #ECCC87;">Resolver.</span>resolve is now traced.
utop[<span style=
"color: #B58DAE; font-weight: bold;">2</span>]&gt; <span style=
"color: #ECCC87;">Scanner.</span>make_scanner <span style=
"color: #A2BF8A;">"var x = 1; { var y = 2; }"</span>
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Scanner.</span>scan_tokens
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Parser.</span>make_parser
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Parser.</span>parse
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Resolver.</span>make_resolver
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Resolver.</span>resolve<span style=
"color: #ff4500;">;;</span>
<span style="color: #ECCC87;">Resolver.</span>resolve &lt;--
  {<span style="color: #ECCC87;">Resolver.</span>statements =
    [<span style="color: #ECCC87;">Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
      {<span style="color: #ECCC87;">Parser.</span>name =
        {<span style=
"color: #ECCC87;">Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>; lexeme = <span style="color: #A2BF8A;">"x"</span>;
         literal = <span style=
"color: #ECCC87;">Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span>};
       init =
        <span style="color: #ECCC87;">Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
         {<span style="color: #ECCC87;">Parser.</span>token =
           {<span style=
"color: #ECCC87;">Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>; lexeme = <span style="color: #A2BF8A;">"1"</span>;
            literal = <span style=
"color: #ECCC87;">Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.; line = <span style="color: #B58DAE; font-weight: bold;">1</span>};
          value = <span style=
"color: #ECCC87;">Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.}};
     <span style="color: #ECCC87;">Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
      [<span style="color: #ECCC87;">Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        {<span style="color: #ECCC87;">Parser.</span>name =
          {<span style=
"color: #ECCC87;">Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>; lexeme = <span style="color: #A2BF8A;">"y"</span>;
           literal = <span style=
"color: #ECCC87;">Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span>};
         init =
          <span style="color: #ECCC87;">Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           {<span style="color: #ECCC87;">Parser.</span>token =
             {<span style=
"color: #ECCC87;">Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>; lexeme = <span style="color: #A2BF8A;">"2"</span>;
              literal = <span style=
"color: #ECCC87;">Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.; line = <span style="color: #B58DAE; font-weight: bold;">1</span>};
            value = <span style=
"color: #ECCC87;">Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.}}]];
   scopes = &lt;abstr&gt;; depths = &lt;abstr&gt;;
</pre>
        </div>
        <p>Notice this last line: <code>scopes = &lt;abstr&gt;;
        depths = &lt;abstr&gt;;</code>. The
        <code>&lt;abstr&gt;</code> value indicates that OCaml does
        not know how to print values of the <code>Scopes.t</code>
        or <code>Depths.t</code> type since there are no dedicated
        <code>pp</code> functions for those types.</p>
        <p>Once I added the <code>[@@deriving show]</code>
        annotation back to <code>type t</code>, wrote the
        <code>Scopes.pp</code> and <code>Depths.pp</code>
        functions, and added the relevant
        <code>#install_printer</code> lines to
        <code>.ocamlinit</code>, this was the full output of the
        same trace to <code>Resolver.resolve</code>:</p>
        <div class="org-src-container">
          <pre class="src src-ocaml">utop[<span style=
          "color: #B58DAE; font-weight: bold;">1</span>]&gt; #trace <span style="color: #ECCC87;">Resolver.</span>resolve<span style="color: #ff4500;">;;</span>
<span style=
"color: #ECCC87;">Resolver.</span>resolve is now traced.
utop[<span style=
"color: #B58DAE; font-weight: bold;">2</span>]&gt; <span style=
"color: #ECCC87;">Scanner.</span>make_scanner <span style=
"color: #A2BF8A;">"var x = 1; { var y = 2; }"</span>
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Scanner.</span>scan_tokens
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Parser.</span>make_parser
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Parser.</span>parse
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Resolver.</span>make_resolver
<span style="color: #f0e68c;">|&gt;</span> <span style=
"color: #ECCC87;">Resolver.</span>resolve<span style=
"color: #ff4500;">;;</span>
<span style="color: #ECCC87;">Resolver.</span>resolve &lt;--
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve &lt;--
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) }))
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve --&gt;
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) }))
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve &lt;--
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
          })
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve &lt;--
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
      ];
    scopes = { y: declared, }; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve --&gt;
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
      ];
    scopes = { y: declared, }; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve --&gt;
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
      ];
    scopes = { y: declared, }; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve &lt;--
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve --&gt;
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
<span style="color: #ECCC87;">Resolver.</span>resolve --&gt;
  { <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
      ];
    scopes = {}; depths = {};
    parsed_statements =
    [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
        { <span style="color: #ECCC87;">Parser.Parser.</span>name =
          { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
            lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
          init =
          (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.);
                 line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
               value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
          });
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Block</span>
         [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
             { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
               { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
                 lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
               init =
               (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                  { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                    { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                      lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                      line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                    value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
               })
           ])
      ]
    }
- : <span style="color: #ECCC87;">Resolver.</span>t =
{ <span style=
"color: #ECCC87;">Resolver.Resolver.</span>statements =
  [(<span style="color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Expression</span>
      (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
         { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
           { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
             lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
           value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) }))
    ];
  scopes = {}; depths = {};
  parsed_statements =
  [(<span style="color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
      { <span style="color: #ECCC87;">Parser.Parser.</span>name =
        { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
          lexeme = <span style=
"color: #A2BF8A;">"x"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
        init =
        (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
               lexeme = <span style=
"color: #A2BF8A;">"1"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.); line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">1</span>.) })
        });
    (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style="color: #ECEFF4; background-color: #272C36;">Block</span>
       [(<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">VarDeclaration</span>
           { <span style=
"color: #ECCC87;">Parser.Parser.</span>name =
             { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Identifier</span>;
               lexeme = <span style=
"color: #A2BF8A;">"y"</span>; literal = <span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNil</span>; line = <span style="color: #B58DAE; font-weight: bold;">1</span> };
             init =
             (<span style=
"color: #ECCC87;">Parser.Parser.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Literal</span>
                { <span style=
"color: #ECCC87;">Parser.Parser.</span>token =
                  { <span style=
"color: #ECCC87;">Scanner.Scanner.</span>token_type = <span style=
"color: #ECCC87;">Scanner.Scanner.</span><span style=
"color: #ECEFF4; background-color: #272C36;">Number</span>;
                    lexeme = <span style=
"color: #A2BF8A;">"2"</span>; literal = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.);
                    line = <span style=
"color: #B58DAE; font-weight: bold;">1</span> };
                  value = (<span style=
"color: #ECCC87;">Value.Value.</span><span style=
"color: #ECEFF4; background-color: #272C36;">LoxNumber</span> <span style="color: #B58DAE; font-weight: bold;">2</span>.) })
             })
         ])
    ]
  }
utop[<span style="color: #B58DAE; font-weight: bold;">8</span>]&gt;
</pre>
        </div>
        <p>Notice how <code>utop</code> now knows how to print the
        <code>Scopes.t</code> and <code>Depths.t</code> types, like
        <code>scopes = { y: declared, }; depths = {};</code>,
        instead of just <code>scopes = &lt;abstr&gt;; depths =
        &lt;abstr&gt;;</code>. This technique is incredibly useful
        for debugging by tracing functions in the REPL and using
        the REPL interactively in general.</p>
        <p>I hope this overview of interactive OCaml development
        with <code>utop</code> was useful. Even though OCaml is a
        language that has an uncompromisingly strict static type
        system, it’s still possible to get some of the useful
        interactive features of more dynamic languages like Lisp
        through a configurable plugin-based REPL and syntax
        extensions that help minimize boilerplate. Sometimes you
        really can have your cake and eat it too!</p>
      </div>
    </div>
    <div class="taglist">
      <a href=
      "https://samarthkishor.github.io/blog/tags.html">Tags</a>:
      <a href=
      "https://samarthkishor.github.io/blog/tag-programming.html">programming</a>
      <a href=
      "https://samarthkishor.github.io/blog/tag-ocaml.html">ocaml</a>
    </div>
    <div id="archive">
      <a href=
      "https://samarthkishor.github.io/blog/archive.html">Other
      posts</a>
    </div>
  </div>
</body>
</html>
